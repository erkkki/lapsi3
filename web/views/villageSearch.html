<script src="js/testCtrl.js"></script>
<div ng-controller="testCtrl">
  <div class="row-fluid">
    <div class="span9">
      <div class="row-fluid">
        <div class="span12">
          <!-- search selection bar -->
            <div class="btn-group" ng-init="servers(); opt.server = 'Select server';">
              <a class="btn dropdown-toggle" data-toggle="dropdown" href="#" ng-model="opt.server">
                {{opt.server}}
                <span class="caret"></span>    
              </a>
              <ul class="dropdown-menu">
                <li><a ng-repeat="server in servers" ng-click="opt.server = server.address; search();">
                  {{server.address}}
                </a></li>
              </ul>
            </div>
            <div class="input-prepend" ng-init="opt.x = '0'" style="margin-top:10px;">
              <span class="add-on">X</span>
              <input class="input-mini" type="number" ng-model="opt.x" ng-change="search()" min="-400" max="400" placeholder="{{opt.x}}">
            </div>
            <div class="input-prepend" ng-init="opt.y = '0'" style="margin-top:10px;">
              <span class="add-on">X</span>
              <input class="input-mini" type="number" ng-model="opt.y" ng-change="search()" min="-400" max="400" placeholder="{{opt.y}}">
            </div>
            <button class="btn btn-info" ng-click="settings = !settings; search();">Settings</button>
            <div class="btn-group" ng-init="opt.count = 10">
              <button class="btn btn-info dropdown-toggle" data-toggle="dropdown" href="#">
                Show: {{opt.count}}
                <span class="caret"></span>
              </button>
              <ul class="dropdown-menu">
                <li><a ng-click="opt.count = 10; search();">10</a></li>
                <li><a ng-click="opt.count = 20; search();">20</a></li>
                <li><a ng-click="opt.count = 40; search();">40</a></li>
                <li><a ng-click="opt.count = 60; search();">60</a></li>
                <li><a ng-click="opt.count = 80; search();">80</a></li>
                <li><a ng-click="opt.count = 100; search();">100</a></li>
              </ul>
            </div>
          <!-- end search bar -->
        </div>
      </div>
      <div class="row-fluid">
        <div class="row-fluid">
          <!-- search result -->
          <div class="span12">
            <div ng-init="results = true;" ng-hide="results">
              <table class="table table-condensed table-bordered table-hover">
                <thead ng-init="opt.limit = 0; openAllLink = true">
                  <tr>
                    <th ng-click="opt.limit = opt.limit - opt.count; search();"><i class="icon-chevron-left"></i></th>
                    <th ng-hide="table.dist">Distance</th>
                    <th ng-hide="table.xy">X.Y <a ng-hide="openAllLink" ng-click="openall('/position_details.php?x=','x');" class="text-error"> Open all</a></th>
                    <th ng-hide="table.pop">Pop</th>
                    <th ng-hide="table.name">Village name<a ng-hide="openAllLink" ng-click="openall('/build.php?id=39&tt=2&z=','id');" class="text-error"> Open all</a></th>
                    <th ng-hide="table.acc">Account <a ng-hide="openAllLink" ng-click="openall('/allianz.php?uid=','uid');" class="text-error"> Open all</a></th>
                    <th ng-hide="table.accpop">Account pop</th>
                    <th ng-hide="table.idle">Idle time</th>
                    <th ng-hide="table.vcount">Village count</th>
                    <th ng-hide="table.guild">Guild <a ng-hide="openAllLink" ng-click="openall('/allianz.php?aid=','aid');" class="text-error"> Open all</a></th>
                    <th ng-click="opt.limit = opt.limit + opt.count; search();"><i class="icon-chevron-right"></i></th>
                  </tr>                
                </thead>
                <tbody ng-init="opt.players=[]; opt.guilds=[];">
                  <tr ng-repeat="village in villages">
                    <td><i class="icon-chevron-down"></i></td>
                    <td ng-hide="table.dist">{{village.dist}}</td>
                    <td ng-hide="table.xy"><a href="http://{{opt.server}}/position_details.php?x={{village.x}}&y={{village.y}}">({{village.x}}|{{village.y}})</a></td>
                    <td ng-hide="table.pop">{{village.population}}</td>
                    <td ng-hide="table.name"><a href="http://{{opt.server}}/build.php?id=39&tt=2&z={{village.id}}">{{village.village}}</a></td>
                    <td ng-hide="table.acc"><a href="http://{{opt.server}}/allianz.php?uid={{village.uid}}">{{village.player}}</a>
                        <i class="icon-plus pull-right" ng-click="opt.players.push({name:village.player,uid:village.uid})"></i></td>
                    <td ng-hide="table.accpop">{{village.uidPopulation}}</td>
                    <td ng-hide="table.idle">{{village.idle}}</td>
                    <td ng-hide="table.vcount">{{village.villagecount}}</td>
                    <td ng-hide="table.guild"><a href="http://{{opt.server}}/allianz.php?aid={{village.aid}}">{{village.alliance}}</a>
                        <i class="icon-plus pull-right" ng-click="opt.guilds.push({name:village.alliance,aid:village.aid})"></i></td>
                    <td><img class="type{{village.tid}}" src="img/img_trans.gif"/></td>      
                  </tr>    
                </tbody>
              </table>
            </div>
          </div>
          <!-- end search result -->
        </div>
        <div class="row-fluid">  
          <!-- search settings -->
          <div class="span12">
            <div ng-init="settings = true;" ng-hide="settings">
              <div class="row-fluid">
                <div class="span6">
                  <div class="row-fluid">
                    <div class="span12">
                      <legend>Players</legend>
                      <div class="inline">
                        <div class="btn-group">
                          <button class="btn btn-info" ng-disabled="!opt.onlyplayers"
                                  ng-click="opt.onlyplayers = !opt.onlyplayers">Hide selected</button>
                          <button class="btn btn-info" ng-disabled="opt.onlyplayers" 
                                  ng-click="opt.onlyplayers = !opt.onlyplayers">Show only selected</button>
                        </div>
                      </div>                      
                      <ul class="inline" style="margin-top:10px;">
                        <li ng-repeat="player in opt.players">
                          <p>
                            <button class="btn btn-small btn-danger" style="margin-bottom: 5px;" 
                                    ng-click="opt.players.splice($index, 1)"><i class="icon-remove"></i> {{player.name}}</button>
                          </p>
                        </li>
                      </ul>
                    </div>
                  </div>
                  <div class="row-fluid">
                    <div class="span12">
                      <legend>Guilds</legend> 
                      <div class="inline">
                        <div class="btn-group">
                          <button class="btn btn-info" ng-disabled="!opt.onlyguilds"
                                  ng-click="opt.onlyguilds = !opt.onlyguilds">Hide selected</button>
                          <button class="btn btn-info" ng-disabled="opt.onlyguilds" 
                                  ng-click="opt.onlyguilds = !opt.onlyguilds">Show only selected</button>
                        </div>
                      </div>
                      <ul class="inline" style="margin-top:10px;">
                        <li ng-repeat="guild in opt.guilds">
                          <p>
                            <button class="btn btn-small btn-danger" style="margin-bottom: 5px;" 
                                    ng-click="opt.guilds.splice($index, 1)"><i class="icon-remove"></i> {{guild.name}}</button>
                          </p>
                        </li>
                      </ul>
                    </div>
                  </div>  
                </div>
                <div class="span6">
                  <div class="row-fluid">
                    <div class="span12">
                      <legend>Table settings</legend>
                      <form class="form-horizontal">
                        <div class="control-group">
                          <label class="control-label">Show / Hide Open all link</label>
                          <div class="controls">
                            <button class="btn" type="button" ng-class="{'btn': openAllLink, 'btn btn-danger': !openAllLink}" 
                                 ng-click="openAllLink = !openAllLink">Toggle</button>
                          </div>
                        </div>
                      </form>
                      <label class="checkbox inline">
                        <input type="checkbox" ng-model="table.dist">
                        Distance
                      </label>
                      <label class="checkbox inline">
                        <input type="checkbox" ng-model="table.xy">
                        X.Y
                      </label>
                      <label class="checkbox inline">
                        <input type="checkbox" ng-model="table.pop">
                        Pop
                      </label>
                      <label class="checkbox inline">
                        <input type="checkbox" ng-model="table.name">
                        Village name
                      </label>
                      <label class="checkbox inline">
                        <input type="checkbox" ng-model="table.acc">
                        Account
                      </label><br>
                      <label class="checkbox inline">
                        <input type="checkbox" ng-model="table.accpop">
                        Account pop
                      </label>
                      <label class="checkbox inline">
                        <input type="checkbox" ng-model="table.idle">
                        Idle
                      </label>
                      <label class="checkbox inline">
                        <input type="checkbox" ng-model="table.vcount">
                        Village count
                      </label>
                      <label class="checkbox inline">
                        <input type="checkbox" ng-model="table.guild">
                        Guild
                      </label>
                    </div>
                  </div>
                  <div class="row-fluid">
                    <div class="span12">
                      <legend>Population limits</legend>
                      <form class="form-horizontal">
                        <div class="control-group">
                          <label class="control-label">Village population</label>
                          <div class="controls" ng-init="opt.vilminpop = 0; opt.vilmaxpop = 2000;">
                            <div class="input-prepend">
                              <span class="add-on">Min</span>
                              <input class="input-small" id="prependedInput" ng-model="opt.vilminpop" min="0" max="1999" type="number">
                            </div>
                            <div class="input-prepend">
                              <span class="add-on">Max</span>
                              <input class="input-small" id="prependedInput" ng-model="opt.vilmaxpop" min="1" max="2000" type="number">
                            </div>
                          </div>
                        </div>
                        <div class="control-group">
                          <label class="control-label">Account population</label>
                          <div class="controls" ng-init="opt.accominpop = 0; opt.accomaxpop = 50000;">
                            <div class="input-prepend">
                              <span class="add-on">Min</span>
                              <input class="input-small" id="prependedInput" ng-model="opt.accominpop" min="0" max="99999" type="number">
                            </div>
                            <div class="input-prepend">
                              <span class="add-on">Max</span>
                              <input class="input-small" id="prependedInput" ng-model="opt.accomaxpop" min="1" max="100000" type="number">
                            </div>
                          </div>
                        </div>
                        <div class="control-group">
                          <label class="control-label">Village count</label>
                          <div class="controls" ng-init="opt.vilcountmin = 1; opt.vilcountmax = 100;">
                            <div class="input-prepend">
                              <span class="add-on">Min</span>
                              <input class="input-small" id="prependedInput" ng-model="opt.vilcountmin" min="1" max="199" type="number">
                            </div>
                            <div class="input-prepend">
                              <span class="add-on">Max</span>
                              <input class="input-small" id="prependedInput" ng-model="opt.vilcountmax" min="1" max="200" type="number">
                            </div>
                          </div>
                        </div>
                      </form>
                    </div>
                  </div>
                  <div class="row-fluid">
                    <div class="span12">
                      <legend>Race selection</legend>
                      <div class="btn-group">
                        <button class="btn" ng-class="{'btn-danger': opt.tribes.roman, 'btn-info': !opt.tribes.roman}" 
                                type="button" ng-click="opt.tribes.roman = !opt.tribes.roman">{{tribes.1}} Romans</button>
                        <button class="btn" ng-class="{'btn-danger': opt.tribes.teuton, 'btn-info': !opt.tribes.teuton}" 
                                type="button" ng-click="opt.tribes.teuton = !opt.tribes.teuton">{{tribes.2}} Teutons</button>
                        <button class="btn" ng-class="{'btn-danger': opt.tribes.gaul, 'btn-info': !opt.tribes.gaul}" 
                                type="button" ng-click="opt.tribes.gaul = !opt.tribes.gaul">{{tribes.3}} Gauls</button>
                        <button class="btn" ng-class="{'btn-danger': opt.tribes.natar, 'btn-info': !opt.tribes.natar}" 
                                type="button" ng-click="opt.tribes.natar = !opt.tribes.natar">{{tribes.5}} Natars</button>
                      </div>
                    </div>
                  </div>                    
                </div>
              </div>  
            </div>
          </div>
          <!-- end search settings -->
        </div>
      </div>
    </div>
    <div class="span3">
      <div class="row-fluid">
        <div class="span12">
          <!-- side -->
          <pre>{{opt | json}}</pre>
          <pre>{{temp | json}}</pre>
          <pre>{{settings | json}}</pre>
        </div>
      </div>
      <div class="row-fluid">
        <div ng-init="down = true;" ng-hide="down">
          <div class="span12">
            Downloading...
          </div>
        </div>
      </div>
    </div>
  </div>
</div>



    